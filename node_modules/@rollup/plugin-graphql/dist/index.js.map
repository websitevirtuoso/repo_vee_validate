{"version":3,"file":"index.js","sources":["../src/toESModules.js","../src/index.js"],"sourcesContent":["/* eslint-disable import/prefer-default-export */\n\nimport { EOL } from 'os';\n\n/**\n * Convert CommonJS exports to ES modules exports\n * @param source Source code to convert\n * @returns The converted source code\n */\nexport function toESModules(source) {\n  if (typeof source !== 'string') {\n    return source;\n  }\n\n  return replaceRequires(replaceModuleExports(source));\n}\n\nfunction replaceModuleExports(source) {\n  return source\n    .replace('module.exports = doc', 'export default doc')\n    .replace(\n      /module\\.exports\\[\"(.*)\"] = oneQuery\\(doc, \"(.*)\"\\)/g,\n      (match, g1, g2) => `export const ${g1} = oneQuery(doc, \"${g2}\")`\n    );\n}\n\nfunction replaceRequires(source) {\n  const imports = {};\n  let index = 0;\n\n  // replace a require statement with a variable\n  const replaceSource = source.replace(/require\\(([^)]+)\\)/gi, (match, path) => {\n    const replacePath = path.replace(/[\"']+/g, '');\n\n    if (!imports[replacePath]) {\n      index += 1;\n      imports[replacePath] = `frgmt${index}`;\n    }\n\n    return imports[replacePath];\n  });\n\n  // prepare import statements\n  const importsOutput = Object.keys(imports)\n    .map((path) => `import ${imports[path]} from \"${path}\";`)\n    .join(EOL);\n\n  return importsOutput + EOL + replaceSource;\n}\n","import { createFilter } from '@rollup/pluginutils';\nimport loader from 'graphql-tag/loader';\n\nimport { toESModules } from './toESModules';\n\nexport default function graphql({ include, exclude } = {}) {\n  // path filter\n  const filter = createFilter(include, exclude);\n  // only .graphql, .graphqls (schema), and .gql files\n  const filterExt = /\\.(graphqls?|gql)$/i;\n\n  return {\n    name: 'graphql',\n    transform(source, id) {\n      if (!filter(id)) return null;\n      if (!filterExt.test(id)) return null;\n\n      // XXX: this.cachable() in graphql-tag/loader\n      const code = toESModules(\n        loader.call(\n          {\n            cacheable() {}\n          },\n          source\n        )\n      );\n\n      const map = { mappings: '' };\n\n      return {\n        code,\n        map\n      };\n    }\n  };\n}\n"],"names":["const","let","EOL","createFilter","loader"],"mappings":";;;;;;;;;;AAAA;AAGA;AACA;AACA;AACA;AACA;AACA;AACO,SAAS,WAAW,CAAC,MAAM,EAAE;AACpC,EAAE,IAAI,OAAO,MAAM,KAAK,QAAQ,EAAE;AAClC,IAAI,OAAO,MAAM,CAAC;AAClB,GAAG;AACH;AACA,EAAE,OAAO,eAAe,CAAC,oBAAoB,CAAC,MAAM,CAAC,CAAC,CAAC;AACvD,CAAC;AACD;AACA,SAAS,oBAAoB,CAAC,MAAM,EAAE;AACtC,EAAE,OAAO,MAAM;AACf,KAAK,OAAO,CAAC,sBAAsB,EAAE,oBAAoB,CAAC;AAC1D,KAAK,OAAO;AACZ,MAAM,qDAAqD;AAC3D,gBAAO,KAAK,EAAE,EAAE,EAAE,EAAE,8BAAqB,EAAE,2BAAqB,EAAE,YAAI;AACtE,KAAK,CAAC;AACN,CAAC;AACD;AACA,SAAS,eAAe,CAAC,MAAM,EAAE;AACjC,EAAEA,IAAM,OAAO,GAAG,EAAE,CAAC;AACrB,EAAEC,IAAI,KAAK,GAAG,CAAC,CAAC;AAChB;AACA;AACA,EAAED,IAAM,aAAa,GAAG,MAAM,CAAC,OAAO,CAAC,sBAAsB,YAAG,KAAK,EAAE,IAAI,EAAK;AAChF,IAAIA,IAAM,WAAW,GAAG,IAAI,CAAC,OAAO,CAAC,QAAQ,EAAE,EAAE,CAAC,CAAC;AACnD;AACA,IAAI,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,EAAE;AAC/B,MAAM,KAAK,IAAI,CAAC,CAAC;AACjB,MAAM,OAAO,CAAC,WAAW,CAAC,GAAG,UAAQ,KAAO,CAAC;AAC7C,KAAK;AACL;AACA,IAAI,OAAO,OAAO,CAAC,WAAW,CAAC,CAAC;AAChC,GAAG,CAAC,CAAC;AACL;AACA;AACA,EAAEA,IAAM,aAAa,GAAG,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;AAC5C,KAAK,GAAG,WAAE,IAAI,yBAAe,OAAO,CAAC,IAAI,EAAC,gBAAU,IAAI,YAAI,CAAC;AAC7D,KAAK,IAAI,CAACE,MAAG,CAAC,CAAC;AACf;AACA,EAAE,OAAO,aAAa,GAAGA,MAAG,GAAG,aAAa,CAAC;AAC7C;;AC3Ce,SAAS,OAAO,IAA0B,EAAE;2BAAP,GAAG,GAArB;4BAAS;;AAAiB;AAC5D;AACA,EAAEF,IAAM,MAAM,GAAGG,wBAAY,CAAC,OAAO,EAAE,OAAO,CAAC,CAAC;AAChD;AACA,EAAEH,IAAM,SAAS,GAAG,qBAAqB,CAAC;AAC1C;AACA,EAAE,OAAO;AACT,IAAI,IAAI,EAAE,SAAS;AACnB,IAAI,6BAAS,CAAC,MAAM,EAAE,EAAE,EAAE;AAC1B,MAAM,IAAI,CAAC,MAAM,CAAC,EAAE,CAAC,IAAE,OAAO,IAAI,GAAC;AACnC,MAAM,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,EAAE,CAAC,IAAE,OAAO,IAAI,GAAC;AAC3C;AACA;AACA,MAAMA,IAAM,IAAI,GAAG,WAAW;AAC9B,QAAQI,0BAAM,CAAC,IAAI;AACnB,UAAU;AACV,YAAY,6BAAS,GAAG,EAAE;AAC1B,WAAW;AACX,UAAU,MAAM;AAChB,SAAS;AACT,OAAO,CAAC;AACR;AACA,MAAMJ,IAAM,GAAG,GAAG,EAAE,QAAQ,EAAE,EAAE,EAAE,CAAC;AACnC;AACA,MAAM,OAAO;AACb,cAAQ,IAAI;AACZ,aAAQ,GAAG;AACX,OAAO,CAAC;AACR,KAAK;AACL,GAAG,CAAC;AACJ;;;;"}